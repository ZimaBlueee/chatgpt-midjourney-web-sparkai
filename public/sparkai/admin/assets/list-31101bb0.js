
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://gitee.com/hooray/fantastic-admin
 * Github https://github.com/hooray/fantastic-admin
 */
  
import{_ as ke}from"./index-c786b651.js";import{A as R}from"./chatgpt-7e0d1d0d.js";import{u as ge}from"./utcformatTime-e76e5157.js";import{M as X,b as _e,c as be,Q as Ve,d as ve,S as we}from"./index-70c9cd4a.js";import{d as Te,r as c,Q as v,B as H,t as xe,o as f,c as S,e as l,f as a,R as A,S as h,b as r,k as p,a as B,w as D,I as _,x as b,J as Ue,U as Z,E as x,W as Me,h as u,X as Ce,q as E}from"./index-56458f60.js";const Re={style:{float:"right"}},Se={class:"flex justify-end mr-5"},Le={class:"flex justify-end mr-5"},Ke=Te({__name:"list",setup(Pe){const N=c(),O=c(),Y=c(0),V=c(!1),L=c(!1),j=c(!1),U=c(!1),ee=v(ve),le=v(X),te=v(we),K=v({keyList:""}),y=v({key:"",model:"",status:"",page:1,size:10}),P=c(),w=c(0),o=v({manufacturer:"",key:"",secretKey:"",model:"",maxModelTokens:null,maxResponseTokens:null,openaiProxyUrl:"",openaiTimeoutMs:null,weight:1,status:1,consumptionRate:1}),ae=v({manufacturer:[{required:!0,message:"请选择厂商",trigger:"blur"}],key:[{required:!0,message:"请填写您的key",trigger:"blur"}],model:[{required:!0,message:"请选择当前key需要绑定的模型",trigger:"change"}],weight:[{required:!1,message:"请填写key的权重值",trigger:"blur"}],status:[{required:!0,message:"请选择key的启用状态",trigger:"change"}],maxModelTokens:[{required:!1,message:"请填写模型最大token数",trigger:"blur"}],maxResponseTokens:[{required:!1,message:"请填写最大回复token数",trigger:"blur"}],openaiProxyUrl:[{required:!1,message:"请填写指定代理地址",trigger:"blur"}]});function G(n){w.value=0,n==null||n.resetFields()}const oe=H(()=>w.value?"更新秘钥":"新增秘钥"),F=H(()=>w.value?"确认更新":"确认新增"),Q=c([]);async function k(){try{L.value=!0;const n=await R.queryKeyList(y);L.value=!1;const{rows:t,count:d}=n.data;Y.value=d,Q.value=t}catch{L.value=!1}}async function ne(n){const{id:t}=n;await R.deleteGptKey({id:t}),x({type:"success",message:"删除秘钥成功！"}),k()}function se(n){w.value=n.id;const{manufacturer:t,key:d,secretKey:s,model:g,weight:T,consumptionRate:m,status:I,type:$,maxModelTokens:M,maxResponseTokens:C,openaiProxyUrl:z,openaiTimeoutMs:i}=n;Me(()=>{Object.assign(o,{manufacturer:t,key:d,secretKey:s,model:g,weight:T,consumptionRate:m,status:I,type:$,maxModelTokens:M,maxResponseTokens:C,openaiProxyUrl:z,openaiTimeoutMs:i})}),V.value=!0}function re(n){n==null||n.resetFields(),k()}async function ue(n){n==null||n.validate(async t=>{t&&(w.value?(await R.updateGptKey({id:w.value,...o}),x({type:"success",message:"更新秘钥成功！"})):(await R.addGptKey(o),x({type:"success",message:"添加秘钥成功！"})),V.value=!1,k())})}function de(n){n==null||n.validate(async t=>{if(t){const{keyList:d}=K,s=d.split(`
`);if(s.length>100)return x.error("批量添加key不能超过100个");if(!s.length)return x.error("请按要求填写您的key秘钥");const g=await R.builCreateGptKey({keyList:s});K.keyList="",x({type:"success",message:g.data}),U.value=!1,k()}})}return xe(()=>{k()}),(n,t)=>{const d=u("el-input"),s=u("el-form-item"),g=u("el-option"),T=u("el-select"),m=u("el-button"),I=u("Plus"),$=u("el-icon"),M=u("el-form"),C=ke,z=u("el-alert"),i=u("el-table-column"),J=u("el-tag"),ie=u("el-popconfirm"),pe=u("el-table"),me=u("el-pagination"),fe=u("el-row"),ye=u("el-switch"),W=u("el-dialog"),q=Ce("loading");return f(),S("div",null,[l(C,null,{default:a(()=>[l(M,{ref_key:"formRef",ref:O,inline:!0,model:y},{default:a(()=>[l(s,{label:"key",prop:"key"},{default:a(()=>[l(d,{modelValue:y.key,"onUpdate:modelValue":t[0]||(t[0]=e=>y.key=e),placeholder:"sk-*** [模糊搜索]"},null,8,["modelValue"])]),_:1}),l(s,{label:"使用模型",prop:"model"},{default:a(()=>[l(T,{modelValue:y.model,"onUpdate:modelValue":t[1]||(t[1]=e=>y.model=e),placeholder:"请选择绑定的模型",clearable:""},{default:a(()=>[(f(!0),S(A,null,h(r(X),e=>(f(),_(g,{key:e,label:e,value:e},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(s,{label:"启用状态",prop:"status"},{default:a(()=>[l(T,{modelValue:y.status,"onUpdate:modelValue":t[2]||(t[2]=e=>y.status=e),placeholder:"请选择key启用状态",clearable:""},{default:a(()=>[(f(!0),S(A,null,h(r(_e),e=>(f(),_(g,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(s,null,{default:a(()=>[l(m,{type:"primary",onClick:k},{default:a(()=>[p(" 查询 ")]),_:1}),l(m,{onClick:t[3]||(t[3]=e=>re(r(O)))},{default:a(()=>[p(" 重置 ")]),_:1})]),_:1}),B("span",Re,[l(m,{type:"success",onClick:t[4]||(t[4]=e=>V.value=!0)},{default:a(()=>[p(" 添加Key "),l($,{class:"ml-3"},{default:a(()=>[l(I)]),_:1})]),_:1})])]),_:1},8,["model"])]),_:1}),l(C,null,{default:a(()=>[l(z,{"show-icon":"",title:"KEY池说明",description:"所有key会按key绑定的模型自动划分为一般AI模型与增强AI模型、key余额耗尽将会自动锁定、每张key支持单独绑定模型与代理、已经上下文长度设置、如果不设置默认以全局配置为准！讯飞星火的apiKey为拼接值`${appId}.${apiKey}`；腾讯混元的apiKey为拼接值`${appId}.${SecretId}`",type:"success"})]),_:1}),l(C,{style:{width:"100%"}},{default:a(()=>[D((f(),_(pe,{border:"",data:r(Q),style:{width:"100%"},size:"large"},{default:a(()=>[l(i,{prop:"key",label:"apiKey",width:"450"}),l(i,{prop:"secretKey",label:"secretKey",width:"320"}),l(i,{prop:"manufacturer",label:"厂商",width:"100"}),l(i,{prop:"model",align:"center",label:"绑定模型",width:"160"},{default:a(e=>[l(J,{type:te.indexOf(e.row.model)>-1?"success":""},{default:a(()=>[p(b(e.row.model),1)]),_:2},1032,["type"])]),_:1}),l(i,{prop:"status",align:"center",label:"启用状态",width:"90"},{default:a(e=>[l(J,{type:r(be)[e.row.status]},{default:a(()=>[p(b(r(Ve)[e.row.status]),1)]),_:2},1032,["type"])]),_:1}),l(i,{prop:"weight",align:"center",label:"秘钥权重",width:"90"}),l(i,{prop:"consumptionRate",align:"center",label:"消耗倍率",width:"90"}),l(i,{prop:"useCount",align:"center",label:"调用次数",width:"90"}),l(i,{prop:"maxModelTokens",align:"center",label:"模型最大上下文",width:"140"},{default:a(e=>[l(m,{type:"info",text:""},{default:a(()=>[p(b(e.row.maxModelTokens||"-"),1)]),_:2},1024)]),_:1}),l(i,{prop:"maxResponseTokens",align:"center",label:"最大回复支持Token",width:"160"},{default:a(e=>[l(m,{type:"info",text:""},{default:a(()=>[p(b(e.row.maxResponseTokens||"-"),1)]),_:2},1024)]),_:1}),l(i,{prop:"openaiProxyUrl",align:"center",label:"绑定的代理地址",width:"230"},{default:a(e=>[l(m,{type:"info",text:""},{default:a(()=>[p(b(e.row.openaiProxyUrl||"-"),1)]),_:2},1024)]),_:1}),l(i,{prop:"createdAt",align:"center",label:"添加时间",width:"120"},{default:a(e=>[p(b(r(ge)(e.row.createdAt,"YYYY-MM-DD")),1)]),_:1}),l(i,{fixed:"right",label:"操作",width:"200"},{default:a(e=>[l(m,{link:"",type:"primary",size:"small",onClick:ce=>se(e.row)},{default:a(()=>[p(" 变更 ")]),_:2},1032,["onClick"]),l(ie,{title:"确认删除此秘钥么?",width:"180","icon-color":"red",onConfirm:ce=>ne(e.row)},{reference:a(()=>[l(m,{link:"",type:"danger",size:"small"},{default:a(()=>[p(" 删除秘钥 ")]),_:1})]),_:2},1032,["onConfirm"])]),_:1})]),_:1},8,["data"])),[[q,r(L)]]),l(fe,{class:"flex justify-end mt-5"},{default:a(()=>[l(me,{"current-page":y.page,"onUpdate:currentPage":t[5]||(t[5]=e=>y.page=e),"page-size":y.size,"onUpdate:pageSize":t[6]||(t[6]=e=>y.size=e),class:"mr-5","page-sizes":[10,20,30,50],layout:"total, sizes, prev, pager, next, jumper",total:r(Y),onSizeChange:k,onCurrentChange:k},null,8,["current-page","page-size","total"])]),_:1})]),_:1}),l(W,{modelValue:r(V),"onUpdate:modelValue":t[20]||(t[20]=e=>Z(V)?V.value=e:null),"close-on-click-modal":!1,title:"添加秘钥",width:"670",onClose:t[21]||(t[21]=e=>G(r(P)))},{footer:a(()=>[B("span",Se,[l(m,{onClick:t[18]||(t[18]=e=>V.value=!1)},{default:a(()=>[p("取消")]),_:1}),l(m,{type:"primary",onClick:t[19]||(t[19]=e=>ue(r(P)))},{default:a(()=>[p(b(r(F)),1)]),_:1})])]),default:a(()=>[D((f(),_(M,{ref_key:"formPackageRef",ref:P,"label-position":"right","label-width":"120px",model:o,rules:ae},{default:a(()=>[l(s,{label:"模型厂商",prop:"manufacturer"},{default:a(()=>[l(T,{modelValue:o.manufacturer,"onUpdate:modelValue":t[7]||(t[7]=e=>o.manufacturer=e),filterable:"",clearable:"",placeholder:"请选择"},{default:a(()=>[(f(!0),S(A,null,h(ee,e=>(f(),_(g,{key:e.code,label:e.name,value:e.code},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(s,{label:"绑定模型",prop:"model"},{default:a(()=>[l(T,{modelValue:o.model,"onUpdate:modelValue":t[8]||(t[8]=e=>o.model=e),filterable:"",clearable:"",placeholder:"请选用当前key绑定的模型"},{default:a(()=>[(f(!0),S(A,null,h(le,e=>(f(),_(g,{key:e,label:e,value:e},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(s,{label:"API key",prop:"key"},{default:a(()=>[l(d,{modelValue:o.key,"onUpdate:modelValue":t[9]||(t[9]=e=>o.key=e),placeholder:"请填写API key"},null,8,["modelValue"])]),_:1}),["baidu","xunfei","tencent"].indexOf(o.manufacturer.toLowerCase())>-1?(f(),_(s,{key:0,label:"Secret Key",prop:"key"},{default:a(()=>[l(d,{modelValue:o.secretKey,"onUpdate:modelValue":t[10]||(t[10]=e=>o.secretKey=e),placeholder:"请填写Secret key"},null,8,["modelValue"])]),_:1})):Ue("",!0),l(s,{label:"启用状态",prop:"status"},{default:a(()=>[l(ye,{modelValue:o.status,"onUpdate:modelValue":t[11]||(t[11]=e=>o.status=e),"active-value":1,"inactive-value":0},null,8,["modelValue"])]),_:1}),l(s,{label:"轮询权重",prop:"weight"},{default:a(()=>[l(d,{modelValue:o.weight,"onUpdate:modelValue":t[12]||(t[12]=e=>o.weight=e),modelModifiers:{number:!0},placeholder:"请填写key的权重、数字越大使用频率越高！"},null,8,["modelValue"])]),_:1}),l(s,{label:"消耗倍率",prop:"consumptionRate"},{default:a(()=>[l(d,{modelValue:o.consumptionRate,"onUpdate:modelValue":t[13]||(t[13]=e=>o.consumptionRate=e),modelModifiers:{number:!0},placeholder:"请填写消耗倍率，默认为1倍，即每次消耗多少积分！数字越大消耗额度越快！"},null,8,["modelValue"])]),_:1}),l(s,{label:"模型最大Token",prop:"maxModelTokens"},{default:a(()=>[l(d,{modelValue:o.maxModelTokens,"onUpdate:modelValue":t[14]||(t[14]=e=>o.maxModelTokens=e),modelModifiers:{number:!0},placeholder:"请填写模型最大Token、不填写默认使用默认！"},null,8,["modelValue"])]),_:1}),l(s,{label:"最大回复Token",prop:"maxResponseTokens"},{default:a(()=>[l(d,{modelValue:o.maxResponseTokens,"onUpdate:modelValue":t[15]||(t[15]=e=>o.maxResponseTokens=e),modelModifiers:{number:!0},placeholder:"请填写最大回复Token、不填写使用默认！"},null,8,["modelValue"])]),_:1}),l(s,{label:"指定代理",prop:"openaiProxyUrl"},{default:a(()=>[l(d,{modelValue:o.openaiProxyUrl,"onUpdate:modelValue":t[16]||(t[16]=e=>o.openaiProxyUrl=e),modelModifiers:{number:!0},placeholder:"请填写key的指定代理、不填写默认使用全局配置！"},null,8,["modelValue"])]),_:1}),l(s,{label:"超时时间",prop:"openaiTimeoutMs"},{default:a(()=>[l(d,{modelValue:o.openaiTimeoutMs,"onUpdate:modelValue":t[17]||(t[17]=e=>o.openaiTimeoutMs=e),modelModifiers:{number:!0},placeholder:"请填写key的超时时间单位（ms）、不填写默认使用全局配置！"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])),[[q,r(j)]])]),_:1},8,["modelValue"]),l(W,{modelValue:r(U),"onUpdate:modelValue":t[25]||(t[25]=e=>Z(U)?U.value=e:null),"close-on-click-modal":!1,title:r(oe),width:"670",onClose:t[26]||(t[26]=e=>G(r(P)))},{footer:a(()=>[B("span",Le,[l(m,{onClick:t[23]||(t[23]=e=>U.value=!1)},{default:a(()=>[p("取消")]),_:1}),l(m,{type:"primary",onClick:t[24]||(t[24]=e=>de(r(N)))},{default:a(()=>[p(b(r(F)),1)]),_:1})])]),default:a(()=>[D((f(),_(M,{ref_key:"formBlukRef",ref:N,"label-position":"right","label-width":"120px",model:o},{default:a(()=>[l(s,{label:"key卡账号列表",prop:"keyList"},{default:a(()=>[l(d,{modelValue:K.keyList,"onUpdate:modelValue":t[22]||(t[22]=e=>K.keyList=e),type:"textarea",rows:8,placeholder:"请粘贴您的key秘钥列表、一行一个、批量添加的情况下我们将默认为您使用erniebot模型、并且不会检测秘钥的有效期、请您自行校验！"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])),[[q,r(j)]])]),_:1},8,["modelValue","title"])])}}});typeof E=="function"&&E(Ke);export{Ke as default};
